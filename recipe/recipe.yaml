# yaml-language-server: $schema=https://raw.githubusercontent.com/prefix-dev/recipe-format/main/schema.json
schema_version: 1

context:
  # source-of-truth
  version: "1.12.15"
  # convenience
  pip_install: -m pip install . -vv --no-deps --no-build-isolation --disable-pip-version-check

recipe:
  name: dagster-meta
  version: ${{ version }}

build:
  noarch: python
  number: 0

outputs:
  # deps of dagster
  - package:
      name: dagster-pipes
    source:
      url: https://pypi.org/packages/source/d/dagster-pipes/dagster_pipes-${{ version }}.tar.gz
      sha256: 918d84d7ba23c2cbe2a272f9b930b66fcf81f334b17fa0fc68470dc1b7ebf30b
    build:
      noarch: python
      script: ${{ PYTHON }} ${{ pip_install }}
    requirements:
      host:
        - pip
        - python ${{ python_min }}.*
        - setuptools
      run:
        - python >=${{ python_min }}
      run_constraints:
        - python ${{ python_min }}.*
    tests:
      - python:
          imports: dagster_pipes
          pip_check: true
          python_version: ${{ python_min }}.*
    about:
      homepage: https://github.com/dagster-io/dagster/tree/master/python_modules/dagster-pipes
      license: Apache-2.0
      license_file: LICENSE
      summary: Toolkit for Dagster integrations with transform logic outside of Dagster

  - package:
      name: dagster-shared
    source:
      url: https://pypi.org/packages/source/d/dagster-shared/dagster_shared-${{ version }}.tar.gz
      sha256: 59ac24ca85814f14316c63203eb5f45be9d87c6bb290619702c5b6a2a3b83b78
    build:
      noarch: python
      script: ${{ PYTHON }} ${{ pip_install }}
    requirements:
      host:
        - pip
        - python ${{ python_min }}.*
        - setuptools
      run:
        - click
        - packaging >=20.9
        - platformdirs
        - pydantic >=2,<3.0.0
        - python >=${{ python_min }}
        - pyyaml >=5.1
        - tomlkit
        - typing_extensions >=4.11.0,<5
      run_constraints:
        - python ${{ python_min }}.*
    tests:
      - python:
          imports: dagster_shared
          pip_check: true
          python_version: ${{ python_min }}.*
    about:
      homepage: https://github.com/dagster-io/dagster/tree/master/python_modules/librariees/dagster-shared
      license: Apache-2.0
      license_file: LICENSE
      summary: Shared code between dagster and dagster-dg.

  # dagster itself
  - package:
      name: dagster
    source:
      url: https://pypi.org/packages/source/d/dagster/dagster-${{ version }}.tar.gz
      sha256: f8d23466f00edba52f868abf6773de737a7ef121182954d3fbc54bd3b72e5212
    build:
      number: 0
      noarch: python
      script: ${{ PYTHON }} ${{ pip_install }}
      python:
        entry_points:
          - dagster = dagster.cli:main
          - dagster-daemon = dagster.daemon.cli:main
    requirements:
      host:
        - pip
        - python ${{ python_min }}.*
        - setuptools
      run:
        - if: match(python_min, ">=3.12")
          then:
            - universal_pathlib >=0.2.0
            - protobuf >=4,<7
          else:
            - universal_pathlib
            - protobuf >=3.20.0,<7
        - ${{ pin_subpackage("dagster-pipes", upper_bound="x.x.x") }}
        - ${{ pin_subpackage("dagster-shared", upper_bound="x.x.x") }}
        - alembic >=1.2.1,!=1.6.3,!=1.7.0,!=1.11.0
        - antlr-python-runtime
        - click >=5.0,<9.0
        - coloredlogs >=6.1,<=14.0
        - docstring_parser
        - filelock
        - grpcio >=1.44.0
        - grpcio-health-checking >=1.44.0
        - jinja2
        - psutil >=1.0
        - python >=${{ python_min }}
        - python-dotenv
        - python-tzdata
        - pytz
        - pywin32-on-windows
        - requests
        - rich
        - setuptools
        - six
        - sqlalchemy >=1.0,<3
        - structlog
        - tabulate
        - tomli <3
        - toposort >=1.0
        - tqdm <5
        - watchdog >=0.8.3,<7
      run_constraints:
        - python ${{ python_min }}.*
        - pywin32 !=226
    tests:
      - python:
          imports:
            - dagster
            - dagster.api
            - dagster.check
            - dagster.cli
            - dagster.config
            - dagster.core.definitions
            - dagster.core.events
            - dagster.core.execution
            - dagster.core.executor
            - dagster.core.instance
            - dagster.core.launcher
            - dagster.core.run_coordinator
            - dagster.core.scheduler
            - dagster.core.selector
            - dagster.core.snap
            - dagster.core.storage
            - dagster.core.system_config
            - dagster.core.types
            - dagster.core.workspace
            - dagster.daemon
            - dagster.grpc
            - dagster.loggers
            - dagster.seven
            - dagster.utils
          pip_check: true
          python_version: ${{ python_min }}.*
      - script:
          - dagster --help
          - dagster-daemon --help
    about:
      homepage: https://github.com/dagster-io/dagster
      license: Apache-2.0
      summary: The data orchestration platform built for productivity.
      documentation: https://dagster.readthedocs.io
      license_file: LICENSE
      description: |
        Dagster lets you define pipelines in terms of the data flow between reusable, logical components,
        then test locally and run anywhere. With a unified view of pipelines and the assets they produce,
        Dagster can schedule and orchestrate Pandas, Spark, SQL, or anything else that Python can invoke.

        Dagster is designed for data platform engineers, data engineers, and full-stack data scientists.
        Building a data platform with Dagster makes your stakeholders more independent and your systems
        more robust. Developing data pipelines with Dagster makes testing easier and deploying faster.

  # other things that use the main `version`
  - package:
      name: create-dagster
    source:
      url: https://pypi.org/packages/source/c/create-dagster/create_dagster-${{ version }}.tar.gz
      sha256: d001efab652a3928838cc104d49a5c4c2562613d441d7aa5d8d52c501af69bfd
    build:
      noarch: python
      script: ${{ PYTHON }} ${{ pip_install }}
      python:
        entry_points:
          - create-dagster = create_dagster.cli:main
    requirements:
      host:
        - pip
        - python ${{ python_min }}.*
        - setuptools
      run:
        - ${{ pin_subpackage("dagster-dg-core", upper_bound="x.x.x") }}
        - python >=${{ python_min }}
      run_constraints:
        - python ${{ python_min }}.*
    tests:
      - python:
          imports: create_dagster
          pip_check: true
          python_version: ${{ python_min }}.*
      - script:
          - create-dagster --help
    about:
      homepage: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/create-dagster
      license: Apache-2.0
      license_file: LICENSE
      summary: CLI for creating a new dg project or workspace.

  - package:
      name: dagster-cloud-cli
    source:
      url: https://pypi.org/packages/source/d/dagster-cloud-cli/dagster_cloud_cli-${{ version }}.tar.gz
      sha256: f4440aec63bbdc378d811964f7447766e3b1d394a1b92e699f4229a818c6432e
    build:
      noarch: python
      script: ${{ PYTHON }} ${{ pip_install }}
      python:
        entry_points:
          - dagster-cloud = dagster_cloud_cli.entrypoint:app
          - dagster-plus = dagster_cloud_cli.entrypoint:app
    requirements:
      host:
        - pip
        - python ${{ python_min }}.*
        - setuptools
      run:
        - ${{ pin_subpackage("dagster-shared", upper_bound="x.x.x") }}
        - click
        - github3.py
        - jinja2
        - packaging >=20.9
        - python >=${{ python_min }}
        - pyyaml >=5.1
        - questionary
        - requests
        - setuptools
        - tomli >=1.1.0
        - typer >=0.4.1
        - validators
      run_constraints:
        - python ${{ python_min }}.*
    tests:
      - python:
          imports: dagster_cloud_cli
          pip_check: true
          python_version: ${{ python_min }}.*
      - requirements:
          run:
            - python ${{ python_min }}.*
        script:
          - dagster-cloud --help
          - dagster-plus --help
    about:
      homepage: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/dagster-cloud-cli
      license: Apache-2.0
      license_file: LICENSE
      summary: Command line interface for Dagster Cloud

  - package:
      name: dagster-dg-cli
    source:
      url: https://pypi.org/packages/source/d/dagster-dg-cli/dagster_dg_cli-${{ version }}.tar.gz
      sha256: 3e78526547aaa2392f1c5b43f2aa50122cd5dae2e35cea0dace130757902a857
    build:
      noarch: python
      script: ${{ PYTHON }} ${{ pip_install }}
      python:
        entry_points:
          - dg = dagster_dg_cli.cli:main
    requirements:
      host:
        - pip
        - python ${{ python_min }}.*
        - setuptools
      run:
        - ${{ pin_subpackage("dagster", upper_bound="x.x.x") }}
        - ${{ pin_subpackage("dagster-dg-core", upper_bound="x.x.x") }}
        - python >=${{ python_min }}
        - typer
      run_constraints:
        - python ${{ python_min }}.*
    tests:
      - python:
          imports: dagster_dg_cli
          pip_check: true
          python_version: ${{ python_min }}.*
      - script:
          - dg --help
    about:
      homepage: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/dagster-dg-cli
      license: Apache-2.0
      license_file: LICENSE
      summary: Experimental API for scaffolding Dagster projects and components. Includes the dg CLI tool.

  - package:
      name: dagster-dg-core
    source:
      url: https://pypi.org/packages/source/d/dagster-dg-core/dagster_dg_core-${{ version }}.tar.gz
      sha256: 932d8b0e7c1e82447675493d24d602e8252d549d76bedbabaf7242eda15f8ac1
    build:
      noarch: python
      script: ${{ PYTHON }} ${{ pip_install }}
    requirements:
      host:
        - pip
        - python ${{ python_min }}.*
        - setuptools
      run:
        - ${{ pin_subpackage("dagster-cloud-cli", upper_bound="x.x.x") }}
        - ${{ pin_subpackage("dagster-shared", upper_bound="x.x.x") }}
        - click >=8,<9
        - click-aliases
        - gql-with-requests
        - jinja2
        - jsonschema
        - markdown
        - packaging
        - python >=${{ python_min }}
        - python-dotenv
        - pyyaml >=5.1
        - rich
        - setuptools
        - tomlkit <0.13.3
        - typer >=0.15.1,<1.0
        - typing_extensions >=4.4.0,<5
        - watchdog
        - yaspin
      run_constraints:
        - python ${{ python_min }}.*
    tests:
      - python:
          imports: dagster_dg_core
          pip_check: true
          python_version: ${{ python_min }}.*
    about:
      homepage: https://github.com/dagster-io/dagster/tree/master/python_modules/libraries/dagster-dg-core
      license: Apache-2.0
      license_file: LICENSE
      summary: Core libraries for the dagster-dg-cli and create-dagster packages.

  - package:
      name: dagster-graphql
    source:
      url: https://pypi.org/packages/source/d/dagster-graphql/dagster_graphql-${{ version }}.tar.gz
      sha256: 3770b0351b0e2d289214d3255605305adf24e22757f55bf70902f3587fe12e11
    build:
      noarch: python
      script: ${{ PYTHON }} ${{ pip_install }}
      python:
        entry_points:
          - dagster-graphql = dagster_graphql.cli:main
    requirements:
      host:
        - pip
        - python ${{ python_min }}.*
        - setuptools
      run:
        - ${{ pin_subpackage("dagster", upper_bound="x.x.x") }}
        - gql-with-requests >=3.0.0,<5.0.0
        - graphene >=3,<4
        - python >=${{ python_min }}
        - requests
        - starlette
      run_constraints:
        - python ${{ python_min }}.*
    tests:
      - python:
          imports:
            - dagster_graphql
            - dagster_graphql.client
            - dagster_graphql.schema
          pip_check: true
          python_version: ${{ python_min }}.*
      - requirements:
          run:
            - python ${{ python_min }}.*
        script:
          - dagster-graphql --help
    about:
      homepage: https://github.com/dagster-io/dagster/tree/master/python_modules/dagster-graphql
      license: Apache-2.0
      license_file: LICENSE
      summary: The GraphQL frontend to python dagster.

  - package:
      name: dagster-webserver
    source:
      url: https://pypi.org/packages/source/d/dagster-webserver/dagster_webserver-${{ version }}.tar.gz
      sha256: f96ada7043cf4b6c9439e229a83650e415f968f1e1c1b87f5f478afc2b04354e
    build:
      noarch: python
      script: ${{ PYTHON }} ${{ pip_install }}
      python:
        entry_points:
          - dagster-webserver = dagster_webserver.cli:main
          - dagster-webserver-debug = dagster_webserver.debug:main
    requirements:
      host:
        - pip
        - python ${{ python_min }}.*
        - setuptools
      run:
        - ${{ pin_subpackage("dagster-graphql", upper_bound="x.x.x") }}
        - ${{ pin_subpackage("dagster", upper_bound="x.x.x") }}
        - click >=7.0,<9.0
        - python >=${{ python_min }}
        - starlette !=0.36.0
        - uvicorn-standard
      run_constraints:
        - python ${{ python_min }}.*
    tests:
      - python:
          imports: dagster_webserver
          pip_check: true
          python_version: ${{ python_min }}.*
      - requirements:
          run:
            - python ${{ python_min }}.*
        script:
          - dagster-webserver --help
          - dagster-webserver-debug --help
    about:
      homepage: https://github.com/dagster-io/dagster/tree/master/python_modules/dagster-webserver
      license: Apache-2.0
      license_file: LICENSE
      summary: Web UI for dagster.

  - package:
      name: dagit
    source:
      url: https://pypi.org/packages/source/d/dagit/dagit-${{ version }}.tar.gz
      sha256: 6fed5c0b13a447cb194e01a9afcc0018212bee6d6462fe08c9cc25667c78c808
    build:
      noarch: python
      script: ${{ PYTHON }} ${{ pip_install }}
      python:
        entry_points:
          - dagit = dagster_webserver.cli:main
          - dagit-debug = dagster_webserver.debug:main
    requirements:
      host:
        - pip
        - python ${{ python_min }}.*
        - setuptools
      run:
        - ${{ pin_subpackage("dagster-webserver", upper_bound="x.x.x") }}
        - python >=${{ python_min }}
      run_constraints:
        - python ${{ python_min }}.*
    tests:
      - python:
          imports: dagit
          pip_check: true
          python_version: ${{ python_min }}.*
      - requirements:
          run:
            - python ${{ python_min }}.*
        script:
          - dagit --help
    about:
      homepage: https://github.com/dagster-io/dagster/tree/master/python_modules/dagit
      license: Apache-2.0
      license_file: LICENSE
      summary: Dagster UI

  - package:
      name: dagster-airflow
    source:
      url: https://pypi.org/packages/source/d/dagster-airflow/dagster_airflow-${{ version }}.tar.gz
      sha256: 5e63077e8371beda17a31fcac8a26355adfd465dd9c8a8c75fe2b1bd59fb2069
    build:
      noarch: python
      script: ${{ PYTHON }} ${{ pip_install }}
    requirements:
      host:
        - pip
        - python ${{ python_min }}.*
        - setuptools
      run:
        - ${{ pin_subpackage("dagster", upper_bound="x.x.x") }}
        - lazy-object-proxy
        - pendulum
        - python >=${{ python_min }}
        - setuptools <71.0.0
      run_constraints:
        - python ${{ python_min }}.*
    tests:
      # not-yet-available-on-conda-forge
      - if: not match(python_min, ">=3.13")
        then:
          requirements:
            run:
              - pip
              # errors with:
              ##  >>> from airflow.hooks.base_hook import BaseHook
              ##  ModuleNotFoundError: No module named 'airflow.hooks.base_hook'
              - airflow <3
              # apache-airflow-providers-fab 2.4.4 has requirement apache-airflow>=3.0.2, but you have apache-airflow 2.11.0.
              - apache-airflow-providers-fab <2
              - python ${{ python_min }}.*
          script:
            - pip check
            - python -c "import dagster_airflow"
    about:
      homepage: https://github.com/dagster-io/dagster/tree/master/python_modules/dagster-airflow
      license: Apache-2.0
      license_file: LICENSE
      summary: Airflow plugin for Dagster

about:
  homepage: https://github.com/dagster-io
  summary: The data orchestration platform built for productivity.
  license: Apache-2.0
  license_file: LICENSE
  documentation: https://dagster.readthedocs.io
  description: >-
    Dagster is a system for building modern data applications. Combining an elegant programming model and beautiful tools, Dagster allows infrastructure engineers, data engineers, and data scientists to seamlessly collaborate to process and produce the trusted, reliable data needed in today's world.

extra:
  feedstock-name: dagster
  recipe-maintainers:
    - xhochy
    - bollwyvl
    - mgasner
